name: Build and Deploy Dev

on:
  push:
    branches:
      - main
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest
    
    steps:
       - name: Checkout code
         uses: actions/checkout@v3

       - name: Set up Node.js
         uses: actions/setup-node@v3
         with:
          node-version: '16'

       - name: Install dependencies
         run: npm install
 
       - name: Build project
         run: npm run build

       - name: Deploy to Development Server
         env: |
         DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }} run: |
          echo "$DEPLOY_KEY" > deploy_key.pem
          chmod 600 deploy_key.pem
          scp -i deploy_key.pem -r ./build/* user@dev-server:/path/to/deploy/
          ssh -i deploy_key.pem user@dev-server 'systemctl restart my-dev-app'